#target photoshop#include common.js/* global activeDocument, ElementPlacement, app, ActionDescriptor, executeAction, charIDToTypeID, DialogModes */var c = charIDToTypeID;var PATH_TO_BACKGROUND = "/Users/p.myagkov/Projects/allmyart/scriptology/for_script_bricks_old.jpg";PSD_FOLDER_PATH = '/Users/p.myagkov/Projects/allmyart/scriptology/samples/';var CSV_ID = 'csv';var WRITE_TO_CSV = true;var MAKE_BACKGROUND = true;var DO_RESIZE = true;WRITE_TO_CSV && createFile(PSD_FOLDER_PATH + OUT_SUBFOLDER, 'pictures.csv', CSV_ID);openFilesInDir(PSD_FOLDER_PATH);WRITE_TO_CSV && closeFile(CSV_ID);function getOutputFileName() {  var origName = getFileNameWoExtension();  var modulesSizes = getModulesSizes();  var newName = '' + modulesSizes.layerSizes.length + '_';  newName += (modulesSizes.overall.width > modulesSizes.overall.height ? 'h' : 'v') + '_';  newName += origName;  return newName;}function processDocument(doc) {  DO_RESIZE && doc.resizeImage(1640);  MAKE_BACKGROUND && makeBackground();  var error = false;  var outFileName = getOutputFileName();  saveJPEG(PSD_FOLDER_PATH + OUT_SUBFOLDER, outFileName);  var moduleSizes = getModulesSizes();  var str = outFileName + ',';  if (!moduleSizes.layerSizes.length) {    str += 'ERROR';    error = true;  } else {    str += moduleSizes.overall.width + ',' + moduleSizes.overall.height + ',';    for (var i = 0; i < moduleSizes.layerSizes.length; i++) {      var size = moduleSizes.layerSizes[i];      str += size.width + ',' + size.height;      if (i != moduleSizes.layerSizes.length - 1) {        str += ',';      }    }  }  WRITE_TO_CSV && writeToFile(str, CSV_ID);  return !error;}function placeImageOnNewLayer(imageFile) {  var desc2 = new ActionDescriptor();  desc2.putPath(c("null"), new File(imageFile));  desc2.putEnumerated(c("FTcs"), c("QCSt"), c("Qcsa"));  var desc3 = new ActionDescriptor();  desc3.putUnitDouble(c("Hrzn"), c("#Pxl"), 0.000000);  desc3.putUnitDouble(c("Vrtc"), c("#Pxl"), 0.000000);  desc2.putObject(c("Ofst"), c("Ofst"), desc3);  executeAction(c("Plc "), desc2, DialogModes.NO);}function checkIfBackgroundExists() {  for (var i = 0; i < activeDocument.artLayers.length; i++) {    var layer = activeDocument.artLayers[i];    if (layer.name === 'bg') {      return true;    }  }  return false;}function makeBackground() {  if (checkIfBackgroundExists()) {    return;  }  placeImageOnNewLayer(PATH_TO_BACKGROUND);  var bgLayer = activeDocument.artLayers[0];  var lastLayer = activeDocument.artLayers[activeDocument.artLayers.length - 1];  bgLayer.name = 'bg';  bgLayer.move(lastLayer, ElementPlacement.PLACEAFTER);}